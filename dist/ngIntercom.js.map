{"version":3,"sources":["webpack:///webpack/universalModuleDefinition?5ca6","webpack:///webpack/bootstrap c95ece3ef97ae95cdaa4?8bd2","webpack:///./src/intercom.service.ts?44f8"],"names":[],"mappings":"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","file":"ngIntercom.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine(\"ngIntercom\", [], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"ngIntercom\"] = factory();\n\telse\n\t\troot[\"ngIntercom\"] = factory();\n})(this, function() {\nreturn \n\n\n/** WEBPACK FOOTER **\n ** webpack/universalModuleDefinition\n **/"," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\texports: {},\n \t\t\tid: moduleId,\n \t\t\tloaded: false\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.loaded = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(0);\n\n\n\n/** WEBPACK FOOTER **\n ** webpack/bootstrap c95ece3ef97ae95cdaa4\n **/","/**\n * Created by voland on 4/2/16.\n */\n\ninterface IIntercomMessage {\n    topic: string;\n    timestamp: string;\n    service?: string;\n    method?: string;\n    arguments?: any[];\n}\n\ninterface IIntercomService {\n    publish(message: IIntercomMessage): void;\n    subscribe(message: string, callback?: any): void;\n}\n\nexport class Intercom implements ng.IServiceProvider {\n    private _instance: string;\n    private _target: string;\n    private _subjects: any;\n\n    constructor() {\n        this._subjects = {};\n        this.$get.$inject = ['$injector'];\n        window.addEventListener('message', (m) => {\n            let message = m.data;\n            this._applyCallbacks(message);\n        });\n        console.log('Intercom initialized');\n    }\n\n    // Configuration function\n    public config(instanceId: string, targetWindow: string) {\n        this._instance = instanceId;\n        this._target = targetWindow;\n        console.log(`LogzioIntercom instance ${instanceId} is configured with target ${targetWindow}`);\n    }\n\n\n    private _getTargetWindow(): ng.IWindowService {\n        return this._target === 'parent' ? window.parent : window.frames[this._target].contentWindow;\n    }\n    \n    private _applyCallbacks(message: IIntercomMessage) {\n        if (message.topic) {\n            this._validateTopic(message.topic);\n            this._subjects[message.topic].forEach((callback: Function) => callback(message));\n        }\n    }\n\n    private _validateTopic(topic: string) {\n        if (!this._subjects[topic]) {\n            this._subjects[topic] = [];\n        }\n    }\n    \n    // Provider's factory function\n    public $get($injector: ng.auto.IInjectorService): IIntercomService {\n        function defaultCallback(message: IIntercomMessage) {\n            let service = $injector.get(message.service);\n            let method = service[message.method];\n            method.apply(service, message.arguments);\n        }\n        return {\n            publish: (message) => {\n                this._getTargetWindow().postMessage(message, '*');\n                this._applyCallbacks(message);\n            },\n            subscribe: (messageTopic, callback) => {\n                this._validateTopic(messageTopic);\n                this._subjects[messageTopic].push(callback || defaultCallback);\n                console.log(this._instance, this._subjects);\n            }\n        };\n    }\n}\n\nexport default angular.module('ngIntercom', []).provider('Intercom', Intercom);\n\n\n/** WEBPACK FOOTER **\n ** ./src/intercom.service.ts\n **/"],"sourceRoot":""}